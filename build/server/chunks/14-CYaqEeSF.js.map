{"version":3,"file":"14-CYaqEeSF.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/dashboard/observation-form/_page.server.js","../../../.svelte-kit/adapter-node/nodes/14.js"],"sourcesContent":["import { a as getUserFromSessionDB, K as createBaseRequestDB2, w as getLatestBaseRequestID, L as createClassRequestDB, t as getUsersWithAccessLevel, i as insertIntoTableDB, v as getUserWithMatchingEmail, o as getSections, p as getUnavailable } from \"../../../../chunks/db.js\";\nimport { S as SESSION_COOKIE_NAME } from \"../../../../chunks/constants.js\";\nasync function insertApprovals(request_id, instructor = null, staff, fic, chair = null) {\n  const insertApproval = async (approver_id, not_null) => {\n    const fd = new FormData();\n    fd.append(\"status\", \"pending\");\n    fd.append(\"request_id\", request_id);\n    if (not_null == 1) fd.append(\"approver_id\", approver_id);\n    try {\n      await insertIntoTableDB(\"approvals\", fd);\n    } catch (error) {\n      throw new Error(\"Error writing to database\");\n    }\n  };\n  if (instructor) await insertApproval(instructor.id, 1);\n  await insertApproval(null, 0);\n  if (fic) await insertApproval(fic.id, 1);\n  if (chair) await insertApproval(chair.id, 1);\n}\nasync function createObservationRequestServer(session_id, purpose, timeslots, instructor) {\n  const user = await getUserFromSessionDB(session_id);\n  await createBaseRequestDB2(purpose, user.user_id, instructor.id);\n  const base_req_id = await getLatestBaseRequestID(user.user_id);\n  for (let i = 0; i < timeslots.length; i++) {\n    await createClassRequestDB(timeslots[i].class_id, base_req_id, timeslots[i].timeslot, timeslots[i].observe_date);\n  }\n  const fic = await getUsersWithAccessLevel(2);\n  await insertApprovals(base_req_id, instructor, null, fic[0], null);\n  return 1;\n}\nconst actions = {\n  createObservationRequest: async ({ request, cookies }) => {\n    const formData = await request.formData();\n    const purpose = \"Observation\";\n    const class_id = formData.get(\"class_id\");\n    const selectedDates = formData.getAll(\"selectedDate\");\n    const selectedSlots = formData.getAll(\"selectedSlot\");\n    let timeslots = [];\n    for (let i = 0; i < selectedDates.length; i++) {\n      timeslots.push({\n        class_id,\n        timeslot: selectedSlots[i],\n        observe_date: selectedDates[i]\n      });\n    }\n    let instructor;\n    let instructorEmail;\n    instructorEmail = formData.get(\"instructor_email\");\n    if (!instructorEmail.endsWith(\"@up.edu.ph\")) {\n      instructorEmail = `${instructorEmail}@up.edu.ph`;\n    }\n    instructor = await getUserWithMatchingEmail(instructorEmail);\n    if (instructor.length < 1 || instructor[0].access_level !== 4) {\n      return {\n        status: 409,\n        body: {\n          message: \"Email of coordinating faculty is not valid.\",\n          error: void 0\n        }\n      };\n    }\n    instructor = instructor[0];\n    const server_req = await createObservationRequestServer(cookies.get(SESSION_COOKIE_NAME), purpose, timeslots, instructor);\n    return {\n      success: true,\n      base_request_uuid: server_req\n    };\n  }\n};\nasync function load() {\n  return {\n    amclasses: await getSections(\"AM\"),\n    pmclasses: await getSections(\"PM\"),\n    unavailable: await getUnavailable()\n  };\n}\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/dashboard/observation-form/_page.server.js';\n\nexport const index = 14;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/dashboard/observation-form/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/dashboard/observation-form/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/14.CrnaV5Hb.js\",\"_app/immutable/chunks/scheduler.DARHZdcz.js\",\"_app/immutable/chunks/index.BOD7_7ti.js\",\"_app/immutable/chunks/each.BDsanpQE.js\",\"_app/immutable/chunks/spread.CgU5AtxT.js\",\"_app/immutable/chunks/index.BW-EZrt_.js\",\"_app/immutable/chunks/Frame.DOMMRkx1.js\",\"_app/immutable/chunks/bundle-mjs.8vkCkPAV.js\",\"_app/immutable/chunks/GradientButton.BraljpKT.js\",\"_app/immutable/chunks/Button.DmkqkWvm.js\",\"_app/immutable/chunks/Card.B-2JLgPn.js\",\"_app/immutable/chunks/Label.CnKRS200.js\",\"_app/immutable/chunks/Input.BZuiHxSs.js\",\"_app/immutable/chunks/Wrapper.DDar7dFK.js\",\"_app/immutable/chunks/Select.CfcdSY0U.js\",\"_app/immutable/chunks/Tabs.DrgSt1v_.js\",\"_app/immutable/chunks/index.CyH2wcdx.js\",\"_app/immutable/chunks/ChevronLeftOutline.Cs3qs69M.js\",\"_app/immutable/chunks/TrashBinSolid.BBSA_bow.js\"];\nexport const stylesheets = [\"_app/immutable/assets/16.C4fDKZK4.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}