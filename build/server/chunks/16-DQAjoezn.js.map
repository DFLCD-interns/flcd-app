{"version":3,"file":"16-DQAjoezn.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/dashboard/requests-form/_page.server.js","../../../.svelte-kit/adapter-node/nodes/16.js"],"sourcesContent":["import { a as getUserFromSessionDB, t as getUsersWithAccessLevel, v as getUserWithMatchingEmail, i as insertIntoTableDB, w as getLatestBaseRequestID } from \"../../../../chunks/db.js\";\nasync function insertBaseRequest(user, data, isFLCD, instructor = null) {\n  const base_fd = new FormData();\n  base_fd.append(\"requester_id\", user?.user_id);\n  if (isFLCD && instructor) base_fd.append(\"instructor_id\", instructor.id);\n  base_fd.append(\"purpose\", data.get(\"purpose\"));\n  if (!isFLCD) base_fd.append(\"affiliation\", data.get(\"affiliation\"));\n  try {\n    await insertIntoTableDB(\"base_requests\", base_fd);\n    const request_id = await getLatestBaseRequestID(user?.user_id);\n    return request_id;\n  } catch (error) {\n    throw new Error(\"Error writing to database\");\n  }\n}\nasync function insertApprovals(request_id, instructor = null, staff, fic, chair = null) {\n  const insertApproval = async (approver_id, not_null) => {\n    const fd = new FormData();\n    fd.append(\"status\", \"pending\");\n    fd.append(\"request_id\", request_id);\n    if (not_null == 1) fd.append(\"approver_id\", approver_id);\n    try {\n      await insertIntoTableDB(\"approvals\", fd);\n    } catch (error) {\n      throw new Error(\"Error writing to database\");\n    }\n  };\n  if (instructor) await insertApproval(instructor.id, 1);\n  if (staff) await insertApproval(staff.id, 0);\n  if (fic) await insertApproval(fic.id, 1);\n  if (chair) await insertApproval(chair.id, 1);\n}\nconst actions = {\n  submitEquipmentRequest: async ({ request, cookies }) => {\n    const session = cookies.get(\"session_id\");\n    const user = await getUserFromSessionDB(session);\n    const data = await request.formData();\n    const staff = await getUsersWithAccessLevel(3);\n    const isFLCD = user?.access_level === 5;\n    let instructor;\n    let instructorEmail;\n    if (isFLCD) {\n      instructorEmail = data.get(\"instructor_email\");\n      if (!instructorEmail.endsWith(\"@up.edu.ph\")) {\n        instructorEmail = `${instructorEmail}@up.edu.ph`;\n      }\n      instructor = await getUserWithMatchingEmail(instructorEmail);\n      if (instructor.length < 1 || instructor[0]?.access_level !== 4) {\n        return {\n          status: 409,\n          body: {\n            message: \"Email of coordinating faculty is not valid.\",\n            error: void 0\n          }\n        };\n      }\n      instructor = instructor[0];\n    }\n    try {\n      const request_id = await insertBaseRequest(user, data, isFLCD, instructor);\n      const fic = await getUsersWithAccessLevel(2);\n      await insertApprovals(request_id, instructor, staff[0], fic[0]);\n      const promised_start_time = data.get(\"promised_start_time\");\n      const promised_end_time = data.get(\"promised_end_time\");\n      const location = data.get(\"location\");\n      const selectedEq = data.getAll(\"selectedEq\");\n      for (let eq of selectedEq) {\n        const quantity = parseInt(data.get(eq));\n        for (let i = 0; i < quantity; i++) {\n          const fd = {\n            promised_start_time,\n            promised_end_time,\n            location,\n            equipment_type: eq,\n            request_id\n          };\n          const form_data = new FormData();\n          for (let key in fd) {\n            form_data.append(key, fd[key]);\n          }\n          await insertIntoTableDB(\"equipment_requests\", form_data);\n        }\n      }\n      return {\n        status: 200,\n        body: {\n          message: \"Form submitted successfully!\",\n          data: \"owo this is Clarisse\"\n        }\n      };\n    } catch (error) {\n      console.error(\"meow\");\n      console.error(error.message);\n      return {\n        status: 500,\n        body: {\n          message: error.message,\n          error: error.message\n        }\n      };\n    }\n  },\n  submitVenueRequest: async ({ request, cookies }) => {\n    const session = cookies.get(\"session_id\");\n    const user = await getUserFromSessionDB(session);\n    const data = await request.formData();\n    const staff = await getUsersWithAccessLevel(3);\n    const isFLCD = user?.access_level === 5;\n    let instructor;\n    if (isFLCD) {\n      let instructorEmail = data.get(\"instructor_email\");\n      if (!instructorEmail.endsWith(\"@up.edu.ph\")) {\n        instructorEmail = `${instructorEmail}@up.edu.ph`;\n      }\n      instructor = await getUserWithMatchingEmail(instructorEmail);\n      if (instructor.length < 1 || instructor[0]?.access_level !== 4) {\n        return {\n          status: 409,\n          body: {\n            message: \"Email of coordinating faculty is not valid.\",\n            error: void 0\n          }\n        };\n      }\n      instructor = instructor[0];\n    }\n    try {\n      const request_id = await insertBaseRequest(user, data, isFLCD, instructor);\n      const fic = await getUsersWithAccessLevel(2);\n      const chair = await getUsersWithAccessLevel(1);\n      await insertApprovals(request_id, instructor, staff[0], fic[0], chair[0]);\n      const selectedVenue = data.getAll(\"selectedVenue\");\n      for (let venueID of selectedVenue) {\n        const fd = {\n          date_needed: data.get(\"date_needed\"),\n          start_time: data.get(\"start_time\"),\n          end_time: data.get(\"end_time\"),\n          venue_id: parseInt(venueID),\n          request_id\n        };\n        const form_data = new FormData();\n        for (let key in fd) {\n          form_data.append(key, fd[key]);\n        }\n        await insertIntoTableDB(\"venue_requests\", form_data);\n      }\n      return {\n        status: 200,\n        body: {\n          message: \"Form submitted successfully!\",\n          data: \"owo this is Clarisse\"\n        }\n      };\n    } catch (error) {\n      return {\n        status: 500,\n        body: {\n          message: error.message,\n          error: error.message\n        }\n      };\n    }\n  }\n};\nexport {\n  actions\n};\n","import * as server from '../entries/pages/dashboard/requests-form/_page.server.js';\n\nexport const index = 16;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/dashboard/requests-form/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/dashboard/requests-form/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/16.BzGDV44H.js\",\"_app/immutable/chunks/scheduler.DARHZdcz.js\",\"_app/immutable/chunks/index.BOD7_7ti.js\",\"_app/immutable/chunks/each.BDsanpQE.js\",\"_app/immutable/chunks/Button.DmkqkWvm.js\",\"_app/immutable/chunks/spread.CgU5AtxT.js\",\"_app/immutable/chunks/bundle-mjs.8vkCkPAV.js\",\"_app/immutable/chunks/GradientButton.BraljpKT.js\",\"_app/immutable/chunks/Card.B-2JLgPn.js\",\"_app/immutable/chunks/Frame.DOMMRkx1.js\",\"_app/immutable/chunks/Label.CnKRS200.js\",\"_app/immutable/chunks/Input.BZuiHxSs.js\",\"_app/immutable/chunks/Wrapper.DDar7dFK.js\",\"_app/immutable/chunks/MultiSelect.CGv41oEy.js\",\"_app/immutable/chunks/Badge.6depYmLh.js\",\"_app/immutable/chunks/index.BW-EZrt_.js\",\"_app/immutable/chunks/Tabs.DrgSt1v_.js\",\"_app/immutable/chunks/index.CyH2wcdx.js\",\"_app/immutable/chunks/ChevronLeftOutline.Cs3qs69M.js\",\"_app/immutable/chunks/forms.BovpqlDw.js\",\"_app/immutable/chunks/entry.B3oirdxR.js\"];\nexport const stylesheets = [\"_app/immutable/assets/16.C4fDKZK4.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}